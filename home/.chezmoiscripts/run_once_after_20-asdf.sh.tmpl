#!/usr/bin/env bash
# -*-mode:sh-*- vim:ft=sh

set -eo pipefail

{{ template "common/script_eval_brew" . }}

. "$(brew --prefix asdf)/libexec/asdf.sh"

# install from ~/.tool-versions
while read plugin version; do
  if asdf plugin-list | grep --silent $plugin; then
    echo "asdf plugin \"${plugin}\" is already installed"
    echo "asdf plugin \"${plugin}\" updating..."
    asdf plugin-update ${plugin}
  else
    echo "installing ${plugin}..."
    asdf plugin-add ${plugin}
  fi

  if ! asdf current ${python} | grep -Fq ${version}; then
    asdf install ${plugin} ${version}
    echo "${plugin} installed to $(which ${plugin})"

    asdf global ${plugin} ${version}
  fi
  asdf reshim ${plugin}
  echo "${plugin} ${version} is activated"
done < ~/.tool-versions

asdf current
