#!/usr/bin/env bash
# -*-mode:sh-*- vim:ft=sh

set -e

{{ template "common/script_eval_brew" . }}
{{ template "common/script_sudo" . }}

PKG_DIR="${HOME}/.config/homebrew"

# Install Homebrew
if ! command -v brew > /dev/null 2>&1 && [ -f "$HOME/.config/homebrew/Brewfile" ]; then
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

fi

# Install Homebrew packages
brew bundle -v --no-lock --file="${PKG_DIR}/Brewfile"

if [ -z "$GITHUB_ACTIONS" ]; then
  brew bundle -v --no-lock --file="${PKG_DIR}/Caskfile"
  brew bundle -v --no-lock --file="${PKG_DIR}/Masfile"
fi

brew list
