{{- /*
// -*-mode:kdl-*- vim:ft=kdl.gotexttmpl
*/ -}}

// If you'd like to override the default keybindings completely, be sure to change "keybinds" to "keybinds clear-defaults=true"
keybinds clear-defaults=true {
    normal {
        // uncomment this and adjust key if using copy_on_select=false
        // bind "Alt c" { Copy; }
        // bind "F12" { SwitchToMode "Locked"; }
    }
    locked {
        bind "F12" { SwitchToMode "Normal"; }
    }
    resize {
        bind "Ctrl n"    { SwitchToMode "Normal"; }
        bind "h" "Left"  { Resize "Increase Left"; }
        bind "j" "Down"  { Resize "Increase Down"; }
        bind "k" "Up"    { Resize "Increase Up"; }
        bind "l" "Right" { Resize "Increase Right"; }
        bind "H"         { Resize "Decrease Left"; }
        bind "J"         { Resize "Decrease Down"; }
        bind "K"         { Resize "Decrease Up"; }
        bind "L"         { Resize "Decrease Right"; }
        bind "=" "+"     { Resize "Increase"; }
        bind "-"         { Resize "Decrease"; }
    }
    pane {
        bind "Ctrl p"    { SwitchToMode "Normal"; }
        bind "h" "Left"  { MoveFocus "Left"; }
        bind "l" "Right" { MoveFocus "Right"; }
        bind "j" "Down"  { MoveFocus "Down"; }
        bind "k" "Up"    { MoveFocus "Up"; }
        bind "p"         { SwitchFocus; }
        bind "n"         { NewPane;                   SwitchToMode "Normal"; }
        bind "d"         { NewPane "Down";            SwitchToMode "Normal"; }
        bind "r"         { NewPane "Right";           SwitchToMode "Normal"; }
        bind "x"         { CloseFocus;                SwitchToMode "Normal"; }
        bind "f"         { ToggleFocusFullscreen;     SwitchToMode "Normal"; }
        bind "z"         { TogglePaneFrames;          SwitchToMode "Normal"; }
        bind "w"         { ToggleFloatingPanes;       SwitchToMode "Normal"; }
        bind "e"         { TogglePaneEmbedOrFloating; SwitchToMode "Normal"; }
        bind "c"         { SwitchToMode "RenamePane"; PaneNameInput 0;}
    }
    move {
        bind "Ctrl h"    { SwitchToMode "Tmux"; }
        bind "n" "Tab"   { MovePane; }
        bind "p"         { MovePaneBackwards; }
        bind "h" "Left"  { MovePane "Left"; }
        bind "j" "Down"  { MovePane "Down"; }
        bind "k" "Up"    { MovePane "Up"; }
        bind "l" "Right" { MovePane "Right"; }
    }
    tab {
        bind "Ctrl t" { SwitchToMode "Normal"; }
        bind "r"      { SwitchToMode "RenameTab"; TabNameInput 0; }
        bind "h"      { GoToPreviousTab; }
        bind "l"      { GoToNextTab; }
        bind "n"      { NewTab;              SwitchToMode "Normal"; }
        bind "x"      { CloseTab;            SwitchToMode "Normal"; }
        bind "s"      { ToggleActiveSyncTab; SwitchToMode "Normal"; }
        bind "b"      { BreakPane;           SwitchToMode "Normal"; }
        bind "]"      { BreakPaneRight;      SwitchToMode "Normal"; }
        bind "["      { BreakPaneLeft;       SwitchToMode "Normal"; }
        bind "1"      { GoToTab 1;           SwitchToMode "Normal"; }
        bind "2"      { GoToTab 2;           SwitchToMode "Normal"; }
        bind "3"      { GoToTab 3;           SwitchToMode "Normal"; }
        bind "4"      { GoToTab 4;           SwitchToMode "Normal"; }
        bind "5"      { GoToTab 5;           SwitchToMode "Normal"; }
        bind "6"      { GoToTab 6;           SwitchToMode "Normal"; }
        bind "7"      { GoToTab 7;           SwitchToMode "Normal"; }
        bind "8"      { GoToTab 8;           SwitchToMode "Normal"; }
        bind "9"      { GoToTab 9;           SwitchToMode "Normal"; }
        bind "Tab"    { ToggleTab; }
    }
    scroll {
        bind "Ctrl s"     { SwitchToMode "Tmux"; }
        bind "s"          { SwitchToMode "EnterSearch"; SearchInput 0; }
        bind "e"          { EditScrollback; SwitchToMode "Normal"; }
        bind "Ctrl c"     { ScrollToBottom; SwitchToMode "Normal"; }
        bind "j" "Down"   { ScrollDown; }
        bind "k" "Up"     { ScrollUp; }
        bind "Ctrl f" "l" { PageScrollDown; }
        bind "Ctrl b" "h" { PageScrollUp; }
        bind "d"          { HalfPageScrollDown; }
        bind "u"          { HalfPageScrollUp; }
    }
    search {
        bind "Ctrl s"     { SwitchToMode "Normal"; }
        bind "Ctrl c"     { ScrollToBottom; SwitchToMode "Normal"; }
        bind "j" "Down"   { ScrollDown; }
        bind "k" "Up"     { ScrollUp; }
        bind "Ctrl f" "l" { PageScrollDown; }
        bind "Ctrl b" "h" { PageScrollUp; }
        bind "d"          { HalfPageScrollDown; }
        bind "u"          { HalfPageScrollUp; }
        bind "n"          { Search "down"; }
        bind "p"          { Search "up"; }
        bind "c"          { SearchToggleOption "CaseSensitivity"; }
        bind "w"          { SearchToggleOption "Wrap"; }
        bind "o"          { SearchToggleOption "WholeWord"; }
    }
    entersearch {
        bind "Enter"  { SwitchToMode "Search"; }
        bind "Esc"    { SwitchToMode "Normal"; }
    }
    renametab {
        bind "Enter"  { SwitchToMode "Normal"; }
        bind "Ctrl c" { SwitchToMode "Normal"; }
        bind "Esc"    { UndoRenameTab; SwitchToMode "Tab"; }
    }
    renamepane {
        bind "Enter"  { SwitchToMode "Normal"; }
        bind "Ctrl c" { SwitchToMode "Normal"; }
        bind "Esc"    { UndoRenamePane; SwitchToMode "Pane"; }
    }
    session {
        bind "Ctrl o" { SwitchToMode "Normal"; }
    }
    tmux {
        // Mode Switching
        bind "Ctrl ;" { Write 2; SwitchToMode "Normal"; }
        bind "t"      { SwitchToMode "Tab"; }
        bind "p"      { SwitchToMode "Pane"; }
        bind "["      { SwitchToMode "Scroll"; }
        bind "m"      { SwitchToMode "Move"; }
        bind "="      { SwitchToMode "Resize"; }
        bind ","      { SwitchToMode "RenameTab"; }
        bind ","      { SwitchToMode "RenameTab";  TabNameInput 0; }
        bind "."      { SwitchToMode "RenamePane"; PaneNameInput 0; }

        // Session
        bind "s" "$" ":" {
            LaunchOrFocusPlugin "session-manager" { floating true; move_to_focused_tab true; }
            SwitchToMode "Normal"
        }

        // Tabs
        bind "c"      { NewTab;          SwitchToMode "Normal"; }
        bind "Ctrl p" { GoToPreviousTab; SwitchToMode "Normal"; }
        bind "Ctrl n" { GoToNextTab;     SwitchToMode "Normal"; }

        // Panes
        bind "|"     { NewPane "Right";   SwitchToMode "Normal"; }
        bind "-"     { NewPane "Down";    SwitchToMode "Normal"; }
        bind "Left"  { MoveFocus "Left";  SwitchToMode "Normal"; }
        bind "Right" { MoveFocus "Right"; SwitchToMode "Normal"; }
        bind "Down"  { MoveFocus "Down";  SwitchToMode "Normal"; }
        bind "Up"    { MoveFocus "Up";    SwitchToMode "Normal"; }
        bind "h"     { MoveFocus "Left";  SwitchToMode "Normal"; }
        bind "l"     { MoveFocus "Right"; SwitchToMode "Normal"; }
        bind "j"     { MoveFocus "Down";  SwitchToMode "Normal"; }
        bind "k"     { MoveFocus "Up";    SwitchToMode "Normal"; }
        bind "x"     { CloseFocus;        SwitchToMode "Normal"; }

        // Pane Resize
        bind "H" { Resize "Increase Left"; }
        bind "L" { Resize "Increase Right"; }
        bind "K" { Resize "Increase Up"; }
        bind "J" { Resize "Increase Down"; }

        // Others
        bind "e"      { EditScrollback;        SwitchToMode "Normal"; }
        bind "z"      { ToggleFocusFullscreen; SwitchToMode "Normal"; }
        bind "o"      { FocusNextPane; }
        bind "d"      { Detach; }
        bind "Space"  { NextSwapLayout; }
    }

    shared_except "locked" {
        bind "F12"               { SwitchToMode "Locked"; }
        bind "Ctrl q"            { Quit; }
        bind "Alt n"             { NewPane; }
        bind "Alt h" "Alt Left"  { MoveFocusOrTab "Left"; }
        bind "Alt l" "Alt Right" { MoveFocusOrTab "Right"; }
        bind "Alt j" "Alt Down"  { MoveFocus "Down"; }
        bind "Alt k" "Alt Up"    { MoveFocus "Up"; }
        bind "Alt =" "Alt +"     { Resize "Increase"; }
        bind "Alt -"             { Resize "Decrease"; }
        bind "Alt ["             { PreviousSwapLayout; }
        bind "Alt ]"             { NextSwapLayout; }
        bind "Alt /" {
            LaunchOrFocusPlugin "forgot" { floating true; move_to_focused_tab true; }
        }
        bind "Left"  { MessagePlugin "navigator" { name "move_focus"; payload "left";  floating false; }; }
        bind "Right" { MessagePlugin "navigator" { name "move_focus"; payload "right"; floating false; }; }
        bind "Up"    { MessagePlugin "navigator" { name "move_focus"; payload "up";    floating false; }; }
        bind "Down"  { MessagePlugin "navigator" { name "move_focus"; payload "down";  floating false; }; }
    }
    // shared_except "normal" "locked" {
    //     bind "Enter" "Esc" { SwitchToMode "Normal"; }
    // }
    // shared_except "resize" "locked" {
    //     bind "Enter" "Esc" { SwitchToMode "Normal"; }
    // }
    // shared_except "pane" "locked" {
    //     bind "Enter" "Esc" { SwitchToMode "Pane"; }
    // }
    // shared_except "move" "locked" {
    //     bind "Enter" "Esc" { SwitchToMode "Move"; }
    // }
    // shared_except "tab" "locked" {
    //     bind "Enter" "Esc" { SwitchToMode "Tab"; }
    // }
    // shared_except "scroll" "locked" {
    //     bind "Enter" "Esc" { SwitchToMode "Scroll"; }
    // }
    // shared_except "session" "locked" {
    //     bind "Enter" "Esc" { SwitchToMode "Session"; }
    // }
    shared_except "tmux" "locked" {
        // bind "Enter" "Esc" { SwitchToMode "Tmux"; }
        bind "Ctrl ;" { SwitchToMode "Tmux"; }
    }
}
