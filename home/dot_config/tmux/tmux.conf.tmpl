{{- /*
# -*-mode:tmux-*- vim:ft=tmux.gotexttmpl
*/ -}}
# -*-mode:tmux-*- vim:ft=tmux

# =============================================================================
# General
# =============================================================================
# Encoding
set -gq utf8

# color
{{- if eq .chezmoi.os "darwin" }}
set -g default-terminal "xterm-256color"
{{ else if eq .chezmoi.os "linux" }}
set -g default-terminal "tmux-256color"
{{ end }}
set -ag terminal-overrides ",xterm-256color:RGB"

set -g mouse on
set -g focus-events on
set -sg escape-time 0 # Avoid time lag on Vim

set -g set-titles on

# Start numbering at one for easier switching
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# Prefix key
unbind C-b
set -g prefix C-";"
bind -n C-";" send-prefix

# Visually marks windows with unread output
set -g visual-activity on

# History
set -g history-limit 10000
set -g history-file "$XDG_CACHE_HOME/tmux/history.log"

# =============================================================================
# Appearance
# =============================================================================
# Status
set -g status-position "bottom"
set -g status "on"
set -g status-interval 5
set -g status-justify left
set -g status-style "fg=#58a6ff,bg=#090c10"

set -g status-left-length "100"
set -g status-right-length "50"

set -g status-left-style NONE
set -g status-right-style NONE

set -g status-left "#[fg=#1f2428,bg=#2188ff,bold] #S #[fg=#2188ff,bg=#1f2428,nobold,nounderscore,noitalics]"
set -g status-right "#[fg=#090c10,bg=#090c10,nobold,nounderscore,noitalics]#[fg=#090c10,bg=#090c10]  #{prefix_highlight} #[fg=#c5c5c5,bg=#090c10,nobold,nounderscore,noitalics]#[fg=#484f58,bg=#c5c5c5] %Y/%m/%d %a  %k:%M #[fg=#58a6ff,bg=#c5c5c5,nobold,nounderscore,noitalics]#[fg=#090c10,bg=#58a6ff,bold] #h "

# Pane
set -g pane-border-style "fg=#b3b1ad"
set -g pane-active-border-style "fg=#58a6ff"

# Window
setw -g window-status-activity-style "underscore,fg=#adbac7,bg=#1e2228"
setw -g window-status-separator ""
setw -g window-status-style "NONE,fg=#22272e,bg=#1e2228"
setw -g window-status-format "#[fg=#1e2228,bg=#1e2228,nobold,nounderscore,noitalics]#[fg=#636e7b,bg=#1e2228,nobold,nounderscore,noitalics] #I  #W #F #[fg=#1e2228,bg=#1e2228,nobold,nounderscore,noitalics]"
setw -g window-status-current-format "#[fg=#090c10,bg=#c5c5c5,nobold,nounderscore,noitalics]#[fg=#484f58,bg=#c5c5c5,bold] #I  #W #F #[fg=#c5c5c5,bg=#090c10,nobold,nounderscore,noitalics]"

# -----------------------------------------------------------------------------
# Keybind
# -----------------------------------------------------------------------------
# Vi keybind on copy mode
setw -g mode-keys vi
setw -g xterm-keys on

# and HJKL for resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Easy to detach
bind M-d detach-client

# Jump to pane
bind g display-panes
set -g display-panes-time 4000

# prefix + r: reload tmux
unbind r
bind r source-file $XDG_CONFIG_HOME/tmux/tmux.conf \; display "tmux config is reloaded!"

bind y setw synchronize-panes

# =============================================================================
# Plugins
# =============================================================================
set -g @plugin "tmux-plugins/tpm"               # Plugin manager
set -g @plugin "tmux-plugins/tmux-logging"      # Easy logging and screen capturing for Tmux
set -g @plugin "tmux-plugins/tmux-sensible"     # basic tmux settings everyone can agree on
set -g @plugin "tmux-plugins/tmux-resurrect"    # Persists tmux environment across system restarts
set -g @plugin "tmux-plugins/tmux-continuum"    # Continuous saving of tmux environment
set -g @plugin "tmux-plugins/tmux-pain-control" # standard pane key-bindings for tmux
set -g @plugin "tmux-plugins/tmux-open"         # Plugin for opening highlighted selection directly from copy mode
set -g @plugin "fabioluciano/tmux-powerkit"     # PowerKit for tmux: https://github.com/fabioluciano/tmux-powerkit/wiki

# Log config
set -g @logging-path "$XDG_CACHE_HOME/tmux/plugins/logging"

# Continuum & Resurrect
set -g @resurrect-capture-pane-contents "on"
set -g @resurrect-strategy-nvim "session"
set -g @continuum-restore "off"

## PowerKit global config
set -g @powerkit_transparent "true"
set -g @powerkit_separator_style "normal"
set -g @powerkit_session_icon "auto"

## PowerKit Theme
set -g @powerkit_theme "tokyo-night"
set -g @powerkit_theme_variant "night"

set -g @powerkit_bar_layout "single"
set -g @powerkit_left_separator ""
set -g @powerkit_right_separator ""

## PowerKit Plugins
set -g @powerkit_plugins "ssh,cloud,kubernetes,wifi,battery,datetime"

set -g @powerkit_plugin_datetime_format "%Y/%m/%d (%a) %H:%M:%S"
set -g @powerkit_plugin_ssh_icon ""
set -g @powerkit_plugin_battery_hide_when_full_and_charging "true"
set -g @powerkit_plugin_wifi_hide_when_connected "true"
set -g @powerkit_plugin_cloud_icon_aws ""
set -g @powerkit_plugin_cloud_icon_gcp ""
set -g @powerkit_plugin_cloud_icon_azure ""
set -g @powerkit_plugin_cloud_providers "all"
set -g @powerkit_plugin_cloud_warn_on_prod "true"
set -g @powerkit_plugin_cloud_prod_accent_color "red"

if-shell "test ! -d $TMUX_PLUGIN_MANAGER_PATH/tpm" \
  "run $TMUX_PLUGIN_MANAGER_PATH/tpm/bin/install_plugins"

# Initialize plugin manager
run "$TMUX_PLUGIN_MANAGER_PATH/tpm/tpm"
