# -*-mode:fish-*- vim:ft=fish.gotexttmpl

# Language/Locale Configuration
set -x LANG ja_JP.UTF-8
set -x LC_CTYPE ja_JP.UTF-8

# prevent layout collapsing in CLI tool
set -gx RUNEWIDTH_EASTASIAN 0

# Path Configuration
fish_add_path {{ .brew_prefix }}/bin
fish_add_path {{ .brew_prefix }}/sbin
fish_add_path $HOME/.local/bin
fish_add_path $XDG_DATA_HOME/nvim/mason/bin

{{- if eq .chezmoi.arch "arm64" }}
set -gx ARCHFLAGS '-arch arm64'
{{- else if eq .chezmoi.arch "amd64" }}
set -gx ARCHFLAGS '-arch x86_64'
{{- end }}

# Editor
set -gx EDITOR nvim
set -gx VISUAL $EDITOR
set -gx NVIM_APPNAME nvim

# w3m
set -gx W3M_DIR "$XDG_CONFIG_HOME/w3m"

# Pager
set -gx PAGER "less"
# set -gx MANPAGER "sh -c 'col -bx | bat -l man -p --style=numbers'"
set -gx MANPAGER "nvim +Man!"
set -gx BAT_THEME "Monokai Extended Origin"
set -gx LESS "--ignore-case --RAW-CONTROL-CHARS --LONG-PROMPT -x-4 -z-4"
set -gx LESSCHARSET "utf-8"
set -gx LESS_TERMCAP_mb (printf "\e[01;31m")
set -gx LESS_TERMCAP_md (printf "\e[01;31m")
set -gx LESS_TERMCAP_me (printf "\e[0m")
set -gx LESS_TERMCAP_se (printf "\e[0m")
set -gx LESS_TERMCAP_so (printf "\e[01;42;30m")    # Search highlight
set -gx LESS_TERMCAP_ue (printf "\e[0m")
set -gx LESS_TERMCAP_us (printf "\e[01;32m")
set -gx LESSHISTFILE "$XDG_DATA_HOME/lesshst"

# Grep
set -x GREP_OPTIONS "--color=always"

# pinact
set -gx PINACT_MIN_AGE 7

# Fish Plugin
## Done notification
set -x __done_min_cmd_duration 60000  # default: 5000 ms

# Keybinds
bind ctrl-c cancel-commandline

# Fish abbreviations
abbr -a -- cl "clear"
abbr -a -- x  "exit"

## File
abbr -a -- o    "open"
abbr -a -- oa   "open -a"
abbr -a -- mv   "mv -iv"
abbr -a -- cp   "cp -iv"
abbr -a -- cpr  "cp -R"
abbr -a -- rm   "rm -iv"
abbr -a -- rmf  "rm -if"
abbr -a -- rmrf "rm -rf"

## Directory
abbr -a -- cwd   "pwd | {{ .cmd.copy }}"
abbr -a -- mkdir "mkdir -pv"

### Moving directory: .*
abbr -a -- ..   "cd .."
abbr -a -- ...  "cd ../.."
abbr -a -- .... "cd ../../.."
abbr -a -- .2 "cd ../../"
abbr -a -- .3 "cd ../../../"
abbr -a -- .4 "cd ../../../../"
abbr -a -- .5 "cd ../../../../../"

## Permission
abbr -a -- co  "chown -v"
abbr -a -- cmx "chmod +x"
abbr -a -- cmr "chmod -R"

## Homebrew: b*
abbr -a -- bi  "brew info"
abbr -a -- bl  "brew list"
abbr -a -- bs  "brew search"
abbr -a -- bin "brew install"
abbr -a -- bun "brew uninstall"
abbr -a -- bug "brew upgrade"
abbr -a -- bar "brew autoremove"
abbr -a -- bsv "brew services"

## Git: g*
abbr -a -- lg "lazygit"

abbr -a -- g   "git"
abbr -a -- gs  "git status --verbose"
abbr -a -- gl  "git log --graph --all"
abbr -a -- gmv "git mv --verbose"

abbr -a -- gd  "git diff"
abbr -a -- ga  "git add --verbose"
abbr -a -- grm "git rm"

abbr -a -- gmg "git merge --verbose"
abbr -a -- gma "git merge --abort"
abbr -a -- gms "git merge --squash"

abbr -a -- gcp  "git cherry-pick"
abbr -a -- gcpe "git cherry-pick --edit"
abbr -a -- gcpn "git cherry-pick --no-commit"
abbr -a -- gcpa "git cherry-pick --abort"
abbr -a -- gcpc "git cherry-pick --continue"

abbr -a -- gsw "git switch"
abbr -a -- gsW "git switch --create"

abbr -a -- gb  "git branch --all"
abbr -a -- gbd "git branch --delete"
abbr -a -- gco "git checkout"
abbr -a -- gcb "git checkout -b"

abbr -a -- gcl "git clone"
abbr -a -- gf  "git fetch origin"
abbr -a -- gpl "git pull origin"
abbr -a -- gps "git push origin"

abbr -a -- grb  "git rebase"
abbr -a -- grba "git rebase --abort"
abbr -a -- grbc "git rebase --continue"
abbr -a -- grbi "git rebase --interactive"
abbr -a -- grbs "git rebase --skip"

abbr -a -- gt  "git tag | sort --version-sort --reverse"
abbr -a -- gta "git tag --annotate"
abbr -a -- gts "git tag --sign"

### GitHub CLI: gh*
abbr -a -- ghd "gh dash"
abbr -a -- ghg "gh graph"
abbr -a -- ghn "gh notify"
abbr -a -- ghs "gh s"
abbr -a -- ghm "gh markdown-preview"

### mise
abbr -a -- m  "mise"
abbr -a -- ml "mise list"
abbr -a -- mi "mise install"
abbr -a -- mu "mise upgrade"
abbr -a -- ms "mise registry | fzf --exit-0"
abbr -a -- mr "mise run"
abbr -a -- mt "mise tasks"

## Docker: d*
abbr -a -- d docker
abbr -a -- dps "docker ps"
abbr -a -- dk  "docker kill"
abbr -a -- dp  "docker pull"
abbr -a -- dP  "docker push"
abbr -a -- dr  "docker run --rm"

### docker compose: dc*
abbr -a -- dc  "docker compose"
abbr -a -- dcb "docker compose build"
abbr -a -- dcu "docker compose up --build -d"
abbr -a -- dcd "docker compose down"
abbr -a -- dcl "docker compose logs"
abbr -a -- dcr "docker compose run --rm"
abbr -a -- dce "docker compose exec"
abbr -a -- dcs "docker compose stop"

### Node.js
#### pnpm: p*
abbr -a -- p   "pnpm"
abbr -a -- pr  "pnpm run"
abbr -a -- pa  "pnpm add"
abbr -a -- pad "pnpm add -D"
abbr -a -- prm "pnpm rm"
abbr -a -- pb  "pnpm build"
abbr -a -- pd  "pnpm dev"
abbr -a -- pi  "pnpm install"
abbr -a -- pl  "pnpm list"
abbr -a -- po  "pnpm outdated"
abbr -a -- pt  "pnpm test"
abbr -a -- px  "pnpm dlx"
abbr -a -- pck "pnpm biome:check"
abbr -a -- pcf "pnpm biome:fix"

# Taskfile
abbr -a -- tb "task build"
abbr -a -- tr "task run"
abbr -a -- tc "task clean"
abbr -a -- tl "task lint"
abbr -a -- tt "task test"
abbr -a -- th "task help"

# Zellij: zl*
abbr -a -- zl  "zellij --layout"
abbr -a -- zld "zellij --layout default"
abbr -a -- zlc "zellij --layout coding"
abbr -a -- zlj "zellij --layout jsdev"
abbr -a -- zlm "zellij --layout monitor"
abbr -a -- zls "zellij-session"

{{ if eq .chezmoi.os "darwin" }}
set -gx GITHUB_ACCESS_TOKEN   (security find-generic-password -s "MCP Server for GitHub" -w)
set -gx OPENAI_API_KEY        (security find-generic-password -s "OpenAI API Key" -w)
set -gx GOOGLE_API_KEY        (security find-generic-password -s "Google API Key" -w)
set -gx GEMINI_API_KEY        (security find-generic-password -s "Gemini API Key" -w)
set -gx AZURE_OPENAPI_API_KEY (security find-generic-password -s "Azure API Key" -w)
set -gx GROQ_API_KEY          (security find-generic-password -s "Groq API Key" -w)
set -gx DEEPL_API_KEY         (security find-generic-password -s "DeepL API Key" -w)
set -gx CONTEXT7_API_KEY      (security find-generic-password -s "Context7 API Key" -w)
{{ else if eq .chezmoi.os "linux" }}
set -gx GITHUB_ACCESS_TOKEN   (secret-tool lookup username $USER key_name "MCP Server for GitHub")
set -gx OPENAI_API_KEY        (secret-tool lookup username $USER key_name "OpenAI API Key")
set -gx GOOGLE_API_KEY        (secret-tool lookup username $USER key_name "Google API Key")
set -gx GEMINI_API_KEY        (secret-tool lookup username $USER key_name "Gemini API Key")
set -gx AZURE_OPENAPI_API_KEY (secret-tool lookup username $USER key_name "Azure API Key")
set -gx GROQ_API_KEY          (secret-tool lookup username $USER key_name "Groq API Key")
set -gx DEEPL_API_KEY         (secret-tool lookup username $USER key_name "DeepL API Key")
set -gx CONTEXT7_API_KEY      (secret-tool lookup username $USER key_name "Context7 API Key")
{{ end }}
